<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PourQuiVoter - Quiz Electoral Municipales 2026</title>
  <meta name="description" content="Ne votez plus au hasard pour les municipales 2026">

  <!-- Anti-FOUC: Load theme before render -->
  <script>
    (function() {
      const theme = localStorage.getItem('pqv-theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>

  <!-- Outfit Font -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div>
          <h1 id="app-title">
            <svg class="app-logo" width="48" height="48" viewBox="0 0 36 36" fill="none"
                 stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <!-- Urne -->
              <path d="M6 14V30H30V14"/>
              <path d="M6 14L10 14L10 10"/>
              <path d="M30 14L26 14L26 10"/>
              <!-- Bulletin inclin√© avec coche -->
              <rect x="12" y="4" width="14" height="14" rx="1" transform="rotate(15 19 11)"/>
              <path d="M16 11L18.5 13.5L24 8" transform="rotate(15 19 11)"/>
            </svg>
            PourQuiVoter
          </h1>
          <p class="tagline">Ne votez plus au hasard</p>
        </div>
      </div>
    </header>

    <!-- √âtape 1 : Choix de la commune -->
    <section id="step-commune" class="step active">
      <h2>O√π votez-vous ?</h2>

      <div class="commune-choice-inline">
        <select id="commune-select" class="commune-select-inline">
          <option value="">S√©lectionnez votre commune...</option>
        </select>
        <button id="btn-geoloc" class="btn btn-secondary btn-geoloc-inline">
          <span data-icon="map-pin"></span> Me localiser
        </button>
      </div>

      <div id="map-container" style="height: 400px; margin-top: 20px; border-radius: 8px; overflow: hidden;"></div>

      <div class="actions">
        <button id="btn-start-quiz" class="btn btn-primary btn-start-quiz-main" disabled>
          <span data-icon="target"></span> Commencer le quiz
        </button>
      </div>

      <div class="contribute-link">
        <a href="/contribuer.html"><span data-icon="lightbulb"></span> Vous avez des tracts de campagne ? Contribuez !</a>
      </div>
    </section>

    <!-- √âtape 2 : Info commune s√©lectionn√©e -->
    <section id="step-commune-info" class="step commune-info-screen">
      <!-- Image de fond -->
      <div class="commune-background" id="commune-background"></div>

      <!-- Contenu -->
      <div class="commune-content">
      <div class="commune-info-card">
        <!-- Photo de la commune -->
        <div id="commune-photo-container" class="commune-photo-container">
          <img id="commune-photo" class="commune-photo" src="" alt="Photo de la commune">
          <div class="commune-photo-overlay">
            <div>
              <span id="commune-photo-name" class="commune-photo-name"></span>
              <div id="maire-badge" class="maire-badge" style="display: none;">
                <span class="maire-icon" data-icon="necktie"></span>
                <span id="maire-nom"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="commune-info-stats">
          <div class="stat-item">
            <div class="stat-icon" data-icon="users" data-icon-size="32"></div>
            <div class="stat-content">
              <div class="stat-value" id="info-population">-</div>
              <div class="stat-label">habitants</div>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon" data-icon="vote" data-icon-size="32"></div>
            <div class="stat-content">
              <div class="stat-value" id="info-candidats">-</div>
              <div class="stat-label">candidats</div>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon" data-icon="edit" data-icon-size="32"></div>
            <div class="stat-content">
              <div class="stat-value" id="info-questions">15</div>
              <div class="stat-label">questions</div>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon" data-icon="clock" data-icon-size="32"></div>
            <div class="stat-content">
              <div class="stat-value">3-5</div>
              <div class="stat-label">minutes</div>
            </div>
          </div>
        </div>

        <!-- Liste des candidats en accord√©on -->
        <div id="candidats-section" class="candidats-accordion" style="display: none;">
          <button class="accordion-toggle" id="accordion-candidats-toggle" onclick="toggleCandidats()">
            <span><span data-icon="vote"></span> Voir les <span id="nb-candidats-display">0</span> candidats</span>
            <span class="accordion-icon">‚ñº</span>
          </button>
          <div class="accordion-content" id="candidats-liste" style="display: none;"></div>
        </div>

        <div class="commune-info-details">
          <div class="info-grid">
            <div class="info-column">
              <h3><span data-icon="info"></span> Ce quiz est bas√© sur :</h3>
              <ul class="info-list">
                <li><span data-icon="check"></span> Les propositions des candidats d√©clar√©s</li>
                <li><span data-icon="check"></span> Les enjeux locaux sp√©cifiques √† votre commune</li>
              </ul>
            </div>
            <div class="info-column">
              <h3><span data-icon="lock"></span> Transparence :</h3>
              <p class="info-note">
                Les questions sont g√©n√©r√©es de mani√®re neutre.
                Vos r√©ponses restent anonymes et ne sont pas conserv√©es.
              </p>
            </div>
          </div>
        </div>

        <div class="actions actions-info-commune">
          <a href="#" id="link-back-to-map" class="link-change-commune"><span data-icon="arrow-left"></span> Changer de commune</a>
          <button id="btn-start-quiz-confirm" class="btn btn-primary btn-start-quiz-main"><span data-icon="target"></span> Commencer le quiz</button>
        </div>
      </div>
      </div>

      <!-- Cr√©dit photo -->
      <div class="photo-credit" id="photo-credit"></div>
    </section>

    <!-- √âtape 3 : Quiz -->
    <section id="step-quiz" class="step">
      <div class="quiz-header-compact">
        <a href="#" id="link-back-to-commune" class="link-back-quiz"><span data-icon="arrow-left"></span></a>
        <div class="quiz-title-progress">
          <h2 id="quiz-commune">Quiz</h2>
          <div class="progress-inline">
            <div class="progress-bar">
              <div id="progress-fill" class="progress-fill"></div>
            </div>
            <p class="progress-text">Q<span id="current-question">1</span>/<span id="total-questions">10</span></p>
          </div>
        </div>
      </div>

      <div class="current-theme-badge">
        <span class="theme-emoji" id="current-theme-emoji">üìã</span>
        <span class="theme-label" id="current-theme-label">TH√àME</span>
      </div>

      <div id="quiz-content" class="quiz-content">
        <!-- Questions g√©n√©r√©es dynamiquement -->
      </div>

      <div class="quiz-nav quiz-nav-sticky">
        <button id="btn-prev" class="btn btn-secondary" disabled><span data-icon="arrow-left"></span> Pr√©c√©dent</button>
        <button id="btn-next" class="btn btn-primary" disabled>Suivant <span data-icon="arrow-right"></span></button>
        <button id="btn-results" class="btn btn-success" style="display:none;">Voir les r√©sultats <span data-icon="target"></span></button>
      </div>
    </section>

    <!-- √âtape 3 : R√©sultats -->
    <section id="step-results" class="step">
      <h2>Vos r√©sultats - <span id="results-commune-name"></span></h2>

      <div id="results-list" class="results-list">
        <!-- R√©sultats g√©n√©r√©s dynamiquement -->
      </div>

      <div class="actions">
        <button id="btn-share" class="btn btn-primary"><span data-icon="send"></span> Partager mes r√©sultats</button>
        <button id="btn-restart" class="btn btn-secondary"><span data-icon="refresh"></span> Recommencer</button>
        <a href="/contribuer.html" class="btn btn-outline"><span data-icon="lightbulb"></span> Contribuer</a>
      </div>
    </section>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;">
      <div class="spinner"></div>
      <p id="loading-message">Chargement...</p>
      <div class="loading-progress">
        <div id="loading-progress-bar" class="loading-progress-bar"></div>
      </div>
      <p id="loading-percentage" class="loading-percentage">0%</p>
    </div>
  </div>

  <footer>
    <p>PourQuiVoter - Municipales 2026 - Rennes M√©tropole</p>
    <p><a href="/admin/index.html">Admin</a> | <a href="https://github.com">Code source</a></p>
  </footer>

  <!-- Theme Toggle Button -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Changer le th√®me">
    <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
    <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
  </button>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="icon-config.js"></script>
  <script src="commune-images.js"></script>
  <script src="app.js"></script>
</body>
</html>
